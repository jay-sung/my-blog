<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="http://localhost:1313/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:1313/apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    .NET GC Deep Dive (2) - LOH(Large Object) Heap | Jay Tech Blog
    
</title>

<link rel="canonical" href="http://localhost:1313/posts/csharp-gc-series/cpp-mem-manage-lib-2/"/>

<meta property="og:url" content="http://localhost:1313/posts/csharp-gc-series/cpp-mem-manage-lib-2/">
  <meta property="og:site_name" content="Jay Tech Blog">
  <meta property="og:title" content=".NET GC Deep Dive (2) - LOH(Large Object) Heap">
  <meta property="og:description" content=".NET GC에서 LOH가 성능에 미치는 영향에 대해서 알아봅니다.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-04T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-08-04T00:00:00+00:00">
    <meta property="article:tag" content="Csharp">
    <meta property="article:tag" content="Dotnet-Gc">












<link rel="stylesheet" href="/assets/combined.min.56b1873d8852f8a5a109abda36c1bfcde55cb48e5bcbe0d8c934a196a7dc374a.css" media="all">











    




</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="http://localhost:1313/">Jay Tech Blog</a>
    </h1>

    <div class="header-menu">
        

        
        

        <p
            class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/posts/">Posts</a><span class="breadcrumbs-separator">/</span>
        <a href="/posts/csharp-gc-series/cpp-mem-manage-lib-2/">.NET GC Deep Dive (2) - LOH(Large Object) Heap</a></div>


<div  class="autonumber" >
  <article>
    <header class="single-intro-container">
        
        <h1 class="single-title">.NET GC Deep Dive (2) - LOH(Large Object) Heap</h1>
        <p class="single-summary">.NET GC에서 LOH가 성능에 미치는 영향에 대해서 알아봅니다.</p>
        
        <div class="single-subsummary">
          
          <div>
            
            <p class="author">Jay645 </p>
            
            <p class="single-date">
              <time datetime="2025-08-04T00:00:00&#43;00:00">August 4, 2025</time>
              &nbsp; · &nbsp;2 min read
            </p>
          </div>
        </div>
        
    </header>
      <aside class="toc">
        <p><strong>Table of contents</strong></p>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#개요">개요</a></li>
    <li><a href="#loh가-성능에-미치는-영향">LOH가 성능에 미치는 영향</a>
      <ul>
        <li><a href="#할당-비용">할당 비용</a></li>
        <li><a href="#수집-비용">수집 비용</a></li>
        <li><a href="#참조-형식이-있는-배열-요소인-경우">참조 형식이 있는 배열 요소인 경우</a></li>
      </ul>
    </li>
    <li><a href="#loh-최적화">LOH 최적화</a></li>
  </ul>
</nav>
      </aside>
    
    <div class="single-content">
      <p>필요 사전 지식: .NET, Windows</p>
<blockquote>
<p>이전 .NET GC Deep Dive (1) - .NET GC Introduction를 보고 오시는 것을 추천합니다.</p></blockquote>
<blockquote>
<p>OS 환경은 Windows를 기준으로 설명합니다.</p></blockquote>
<h2 class="heading" id="개요">
  개요
  <a class="anchor" href="#%ea%b0%9c%ec%9a%94">#</a>
</h2>
<p>개체의 크기가 85,000 바이트보다 크거나 같으면 LOH(Large Object Heap) 개체라고 부릅니다.</p>
<h2 class="heading" id="loh가-성능에-미치는-영향">
  LOH가 성능에 미치는 영향
  <a class="anchor" href="#loh%ea%b0%80-%ec%84%b1%eb%8a%a5%ec%97%90-%eb%af%b8%ec%b9%98%eb%8a%94-%ec%98%81%ed%96%a5">#</a>
</h2>
<p>LOH의 할당은 다음과 같은 부분에서 성능에 영향을 줍니다.</p>
<h3 class="heading" id="할당-비용">
  할당 비용
  <a class="anchor" href="#%ed%95%a0%eb%8b%b9-%eb%b9%84%ec%9a%a9">#</a>
</h3>
<p>CLR은 새 개체를 할당할 때마다 해당 메모리가 초기화되도록 보장합니다. 큰 개체의 할당 비용은 메모리 지우기(GC에 트리거하지 않는 한)에 의해 좌우됩니다.(1바이트에 두 주기가 걸리는 것에 비해 큰 개체는 170,000 주기가 걸림)</p>
<h3 class="heading" id="수집-비용">
  수집 비용
  <a class="anchor" href="#%ec%88%98%ec%a7%91-%eb%b9%84%ec%9a%a9">#</a>
</h3>
<p>LOH와 2세대가 함께 수집되기 때문에 하나의 임계값을 초과하면 2세대 컬렉션이 트리거됩니다. 2세대가 LOH보다 큰 경우 많은 큰 개체가 일시적으로 할당되고 GC가 느려질 수 있습니다.</p>
<h3 class="heading" id="참조-형식이-있는-배열-요소인-경우">
  참조 형식이 있는 배열 요소인 경우
  <a class="anchor" href="#%ec%b0%b8%ec%a1%b0-%ed%98%95%ec%8b%9d%ec%9d%b4-%ec%9e%88%eb%8a%94-%eb%b0%b0%ec%97%b4-%ec%9a%94%ec%86%8c%ec%9d%b8-%ea%b2%bd%ec%9a%b0">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="font-weight:bold;text-decoration:underline">class</span> <span style="color:#666;font-weight:bold;font-style:italic">Node</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    Data d;
</span></span><span style="display:flex;"><span>    Node left;
</span></span><span style="display:flex;"><span>    Node right;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Node[] binTree = <span style="font-weight:bold;text-decoration:underline">new</span> Node [num_nodes];
</span></span></code></pre></div><p><code>Node[]</code>는 요소 하나하나가 <code>Node</code>라는 참조 타입을 가리킵니다. 그리고 이 <code>Node</code> 클래스 안에서 <code>left</code>, <code>right</code> 같은 또 다른 참조가 들어있습니다. GC는 이 배열을 수집할 때 모든 Node를 순회하며 그 안의 참조를 따라가야 하고, 그로인해 GC 비용이 커집니다.</p>
<p>위 세 가지 요인 중에서 처음 두 가지는 일반적으로 세 번째 요소보다 중요한 문제입니다. 따라서 임시 개체를 할당하는 대신 다시 사용하는 큰 개체 풀을 할당하는 것이 좋습니다.</p>
<h2 class="heading" id="loh-최적화">
  LOH 최적화
  <a class="anchor" href="#loh-%ec%b5%9c%ec%a0%81%ed%99%94">#</a>
</h2>
<p>LOH를 최적화 하기 위해서 제시되는 방법들은 다음과 같습니다.</p>
<ol>
<li>큰 개체 재사용: 풀링 기법을 통해 재사용하여 LOH의 할당을 줄입니다. (Ex. ArrayPool<!-- raw HTML omitted -->)</li>
<li>메모리 사용 모니터링 : dotnet-trace, PerfView 등과 같은 도구로 LOH 사용량을 추적합니다.</li>
<li>큰 개체를 나눠 SOH(Small Object Heap)으로 분리하기 : 구조적으로 쪼갤 수 있는 LOH라면 SOH에서 관리되도록 설계. (Ex. 참조형 맴버를 인덱스를 통해서 관리 하도록 분리)</li>
</ol>
<blockquote>
<p>자료 : <a href="https://learn.microsoft.com/ko-kr/dotnet/standard/garbage-collection/large-object-heap">https://learn.microsoft.com/ko-kr/dotnet/standard/garbage-collection/large-object-heap</a></p></blockquote>

    </div>
  </article>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">←</div>
                <div class="single-pagination-text">
                    <a href="/posts/csharp-gc-series/cpp-mem-manage-lib-1/">
                        .NET GC Deep Dive (1) - .NET GC Introduction
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/posts/cpp-value-categories/">
                        C&#43;&#43; Value Categories
                    </a>
                </div>
                <div class="single-pagination-text">→</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
